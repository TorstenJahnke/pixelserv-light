# TLSGateNX Silent Blocker Configuration
# Based on Mokku's Hard2Block approach (see signal-2025-11-12-132732_002.png)
#
# Format: domain path-pattern delay(ms) status [reverse-proxy=on]
#
# domain:       Exact domain or wildcard (*.example.com)
# path-pattern: Path with (*) wildcards for segments
# delay:        Delay in milliseconds before response (0 = instant)
# status:       HTTP status code (usually 204 No Content)
# reverse-proxy: Optional - fetch real response from origin server with SSL termination
#                Cache: 2-5MB LRU (only if reverse-proxy=on)
#
# Pattern Syntax:
#   (*) = matches one path segment (anything except /)
#   /(*)/(*)/(*) = EXACTLY 3 path segments required
#
# Examples:
#   /(*)/(*)/(*) → matches /a/b/c (3 segments, EXACT!)
#   /(*)/(*)     → matches /a/b (2 segments, EXACT!)
#   /(*)         → matches /a (1 segment, EXACT!)
#
# Wildcard Subdomains:
#   *.example.com → matches any.example.com, sub.example.com, etc.
#   example.com   → matches only example.com (not subdomains)

# ============================================================================
# Tracking Domains (from Mokku screenshot)
# ============================================================================

# html-load.com - Malvertising/Tracking
html-load.com /(*)/(*)/(*)/(*)/(*)/(*)/(*) 0 204
html-load.com /(*)/(*) 0 204

# Wildcard subdomains for html-load.com
*.html-load.com /(*)/(*)/(*)/(*)/(*)/(*)/(*) 0 204
*.html-load.com /(*)/(*)/(*)/(*)/(*)/(*)/(*)/(*) 0 204

# loader.gutefrage.net - Tracking
loader.gutefrage.net /(*)/(*) 0 204
loader.gutefrage.net /(*)/(*)/(*)/(*)/(*)/(*)/(*)/(*)/(*) 0 204
loader.gutefrage.net /(*)/(*)/(*)/(*)/(*)/(*)/(*)/(*) 0 204

# Wildcard subdomains for loader.gutefrage.net
*.loader.gutefrage.net /(*)/(*)/(*)/(*)/(*)/(*)/(*)/(*)/(*) 0 204

# ============================================================================
# Additional Tracking Domains (Examples - uncomment to enable)
# ============================================================================

# Google Analytics
# google-analytics.com /(*) 0 204
# google-analytics.com /(*)/(*) 0 204
# *.google-analytics.com /(*) 0 204

# Facebook Pixel
# facebook.com /(*)/(*) 0 204

# DoubleClick
# doubleclick.net /(*) 0 204
# doubleclick.net /(*)/(*) 0 204
# *.doubleclick.net /(*) 0 204
# *.doubleclick.net /(*)/(*) 0 204

# Generic ad/tracking domains
# ads.example.com /(*) 0 204
# tracking.example.com /(*)/(*) 0 204
# pixel.example.com /(*) 0 204

# ============================================================================
# Testing Examples (with delay simulation)
# ============================================================================

# Simulate slow response for testing (100ms delay)
# slow-tracker.example.com /(*) 100 204
# slow-tracker.example.com /(*)/(*) 100 204

# Return different status codes for testing
# test-blocker-200.example.com /(*) 0 200
# test-blocker-404.example.com /(*) 0 404

# ============================================================================
# Reverse-Proxy Examples (fetch real response from origin server)
# ============================================================================
# Format: domain path-pattern delay status reverse-proxy=on
#
# When reverse-proxy=on:
#   1. TLSGateNXv3 fetches real response from origin server via HTTPS
#   2. Response is cached (2-5MB LRU cache)
#   3. Silent-block rules (delay, status code) are applied AFTER fetch
#   4. Result is returned to client with SSL termination
#
# IMPORTANT: Make sure origin server is reachable and stable!
#
# Examples (uncomment to enable):

# html-load.com - Fetch real response, apply 50ms delay before sending
# html-load.com /(*)/(*) 50 204 reverse-proxy=on

# loader.gutefrage.net - Fetch real response, instant response
# loader.gutefrage.net /(*)/(*) 0 204 reverse-proxy=on

# google-analytics.com - Fetch with 100ms delay (simulate network latency)
# google-analytics.com /(*) 100 200 reverse-proxy=on
# google-analytics.com /(*)/(*) 100 200 reverse-proxy=on

# facebook.com - Fetch without delay
# facebook.com /(*)/(*) 0 204 reverse-proxy=on

# ============================================================================
# Notes
# ============================================================================
#
# - Lines starting with # are comments
# - Empty lines are ignored
# - Maximum 1024 rules supported
# - Rules are checked in order (first match wins)
# - Segment count must match EXACTLY (no "minimum" matching)
# - Config is loaded at startup, reload with SIGHUP or restart
#
# Usage in TLSGateNX:
#
#   1. Place this file in /etc/tlsgateNG/silent-blocks.conf
#   2. TLSGateNX loads it automatically at startup
#
#   WITHOUT reverse-proxy=on:
#   - Matching requests return generated response (204/200/etc)
#   - Non-matching requests → normal response generation (GIF/JS/CSS)
#
#   WITH reverse-proxy=on:
#   - Matching requests fetch real response from origin server
#   - Response cached (2-5MB LRU)
#   - Silent-block rules applied (delay, status override)
#   - Result returned with SSL termination
#
# Debugging:
#
#   Check logs for:
#     "Silent blocker: Loaded N rules from /etc/tlsgateNG/silent-blocks.conf"
#     "Silent blocker: Config file not found (...), disabled"
#
#   For reverse-proxy=on rules:
#     "Reverse-proxy: Fetching [domain][path] ..."
#     "Reverse-proxy: Cache HIT [domain][path]"
#     "Reverse-proxy: Cache MISS [domain][path]"
#     "Reverse-proxy: Fetch failed [domain][path] - timeout/error"
#     "Reverse-proxy: Cache size: XXX MB"
#
# Performance:
#
#   - Linear search through rules (O(n))
#   - Optimized for typical 10-100 rules
#   - If you have 1000+ rules, sort by frequency (most common first)
#
